# A-Stock Analysis Skill - 使用指南

## 🚀 快速开始

### 1. 安装依赖
```bash
cd /root/.openclaw/workspace/skills/a-stock-analysis
pip install -r requirements.txt
```

### 2. 测试功能
```bash
cd /root/.openclaw/workspace/skills/a-stock-analysis/scripts
python3 test_templates.py
```

### 3. 生成第一个报告
```bash
cd /root/.openclaw/workspace/skills/a-stock-analysis/scripts

# 生成个股分析报告
python3 quick_report.py stock 600519 "贵州茅台"

# 生成指数分析报告
python3 quick_report.py index 000922 "中证红利"

# 生成行业分析报告
python3 quick_report.py sector 000986 "能源行业"
```

## 📊 报告类型

### 个股分析报告
使用 `stock_report_template.md`，适用于：
- 上市公司详细分析
- 基本面分析
- 技术面分析
- 投资建议

### 指数分析报告
使用 `index_report_template.md`，适用于：
- 市场指数分析
- ETF基金分析
- 指数编制方案
- 成分股分布

### 行业分析报告
使用 `sector_report_template.md`，适用于：
- 行业整体分析
- 产业链分析
- 竞争格局
- 政策影响

## 🎯 常用场景

### 场景1：选股决策
```bash
# 生成贵州茅台深度分析报告
python3 quick_report.py stock 600519 "贵州茅台" --template stock_report_template.md --output "贵州茅台_深度分析报告.md"
```

### 场景2：配置指数基金
```bash
# 对比几个指数的估值水平
python3 quick_report.py index 000922 "中证红利"
python3 quick_report.py index 000300 "沪深300"
python3 quick_report.py index 000905 "中证500"
```

### 场景3：行业轮动研究
```bash
# 分析能源行业
python3 quick_report.py sector 000986 "能源行业"

# 对比消费和科技行业
python3 quick_report.py sector 000987 "金融地产"
python3 quick_report.py sector 000991 "信息技术"
```

## 🔧 高级用法

### 自定义报告
```python
from templates.engine import render_template

# 准备分析数据
data = {
    'stock_code': '600519',
    'stock_name': '贵州茅台',
    'current_price': 1850.00,
    'pe_ttm': 35.2,
    'pb': 11.5,
    'dividend_yield': 1.5,
    'market_cap': '23,200亿元',
    'profit_growth': '+12.5%',
    'sales_growth': '+8.2%',
    'investment_rating': '买入',
    'target_price': 2200.00,
    'upside_potential': '+18.9%',
    'risk_level': '中等风险',
    'bullish_point_1': '高端白酒品牌护城河',
    'bullish_point_2': '稳定的现金流和高ROE',
    'bullish_point_3': '奢侈品属性抗通胀',
    'bearish_point_1': '估值相对较高',
    'bearish_point_2': '消费税政策风险',
    'bearish_point_3': '渠道库存风险',
    'catalysts': '新品推出、价格调整、旺季需求',
    'risk_description': '市场波动风险、政策风险',
    'data_period': '2025年12月-2026年2月'
}

# 渲染报告
report_content = render_template('stock_report_template.md', data)

# 保存报告
with open('贵州茅台_分析报告.md', 'w', encoding='utf-8') as f:
    f.write(report_content)
```

### 批量报告生成
```python
import concurrent.futures
from quick_report import generate_stock_report
from templates.engine import render_template

# 需要分析的股票列表
stock_list = [
    {'stock_code': '600519', 'stock_name': '贵州茅台'},
    {'stock_code': '000858', 'stock_name': '五粮液'},
    {'stock_code': '000001', 'stock_name': '平安银行'},
    {'stock_code': '601318', 'stock_name': '中国平安'}
]

# 并行生成报告
with concurrent.futures.ThreadPoolExecutor(max_workers=4) as executor:
    futures = []
    
    for stock in stock_list:
        def task(stock_data):
            try:
                data = generate_stock_report(
                    stock_data['stock_code'], stock_data['stock_name'], None, None
                )
                content = render_template('stock_report_template.md', data)
                filename = f"{stock_data['stock_name']}_{stock_data['stock_code']}_分析报告.md"
                
                with open(filename, 'w', encoding='utf-8') as f:
                    f.write(content)
                
                return filename
            
            except Exception as e:
                print(f"❌ {stock_data['stock_name']} 失败: {e}")
                return None
        
        futures.append(executor.submit(task, stock))
    
    # 获取结果
    for future in concurrent.futures.as_completed(futures):
        result = future.result()
        if result:
            print(f"✅ 成功生成: {result}")
```

## 📈 集成到分析流程

### 配合其他分析工具
```python
import akshare as ak
from templates.engine import render_template

# 1. 使用AKShare获取实时数据
def get_stock_data(stock_code):
    try:
        # 获取实时行情
        quote = ak.stock_zh_a_spot_em().loc[
            lambda x: x['代码'] == stock_code
        ]
        
        if not quote.empty:
            return {
                'stock_code': stock_code,
                'stock_name': quote['名称'].values[0],
                'current_price': quote['最新价'].values[0],
                'pe_ttm': quote['市盈率-ttm'].values[0],
                'pb': quote['市净率'].values[0],
                'market_cap': quote['总市值'].values[0],
                'report_date': quote['日期'].values[0]
            }
    
    except Exception as e:
        print(f"❌ 获取数据失败: {e}")
        return None

# 2. 生成报告
def generate_quick_report(stock_code, stock_name):
    stock_data = get_stock_data(stock_code)
    
    if stock_data:
        report_content = render_template('stock_report_template.md', stock_data)
        
        output_file = f"{stock_name}_{stock_code}_快速分析报告.md"
        with open(output_file, 'w', encoding='utf-8') as f:
            f.write(report_content)
        
        print(f"✅ 报告已生成: {output_file}")
        return output_file
```

## 🔍 故障排除

### 常见问题

#### 1. 模板文件未找到
```bash
Error: Template not found: stock_report_template.md

# 解决方法：
cd /root/.openclaw/workspace/skills/a-stock-analysis/scripts
ls -la ../templates
```

#### 2. 依赖包缺失
```bash
ModuleNotFoundError: No module named 'akshare'

# 解决方法：
cd /root/.openclaw/workspace/skills/a-stock-analysis
pip install -r requirements.txt
```

#### 3. 文件权限问题
```bash
Permission denied: 'report.md'

# 解决方法：
cd /root/.openclaw/workspace/skills/a-stock-analysis/scripts
chmod +w .
```

#### 4. 网络连接问题
```bash
ConnectionError: HTTPSConnectionPool(host='...')

# 解决方法：
# 检查网络连接
# 尝试使用代理
```

### 调试建议

#### 1. 启用详细日志
```bash
cd /root/.openclaw/workspace/skills/a-stock-analysis/scripts
python3 quick_report.py stock 600519 "贵州茅台" -v
```

#### 2. 逐步调试
```python
# 在 Python 交互模式中逐步调试
python3
>>> from templates.engine import render_template
>>> from quick_report import generate_stock_report
>>> data = generate_stock_report('600519', '贵州茅台', None, None)
>>> content = render_template('stock_report_template.md', data)
>>> len(content.split())
```

## 🎯 最佳实践

### 1. 定期更新依赖
```bash
cd /root/.openclaw/workspace/skills/a-stock-analysis
pip list --outdated
pip install --upgrade $(pip list --outdated | grep -v 'Package' | cut -d ' ' -f 1)
```

### 2. 管理报告文件
```bash
# 创建专门的报告目录
mkdir -p 报告输出/2026年
cd /root/.openclaw/workspace/skills/a-stock-analysis/scripts
python3 quick_report.py index 000922 "中证红利" --output "../报告输出/2026年/中证红利_20260220.md"
```

### 3. 备份重要报告
```bash
# 使用Git管理报告
cd /root/.openclaw/workspace/skills/a-stock-analysis
git add "报告输出/2026年/*.md"
git commit -m "添加2026年2月指数分析报告"
```

### 4. 自动化任务
```bash
# 创建每日报告生成脚本
cat > daily_report.sh <<'EOF'
#!/bin/bash
cd /root/.openclaw/workspace/skills/a-stock-analysis/scripts

# 生成几个重点指数报告
python3 quick_report.py index 000922 "中证红利" --output "../报告输出/$(date +%Y%m%d)/中证红利_$(date +%Y%m%d).md"
python3 quick_report.py index 000300 "沪深300" --output "../报告输出/$(date +%Y%m%d)/沪深300_$(date +%Y%m%d).md"
python3 quick_report.py index 000905 "中证500" --output "../报告输出/$(date +%Y%m%d)/中证500_$(date +%Y%m%d).md"

# 清理旧报告（保留最近7天）
find ../报告输出 -type f -name "*.md" -mtime +7 -delete
EOF

# 给予执行权限
chmod +x daily_report.sh

# 每日定时任务（添加到 crontab）
0 18 * * * /root/.openclaw/workspace/skills/a-stock-analysis/scripts/daily_report.sh >> /root/.openclaw/workspace/skills/a-stock-analysis/logs/daily_report.log 2>&1
```

## 📚 资源链接

### 官方文档
- **SKILL.md** - 技能功能说明
- **TEMPLATES.md** - 模板引擎详细文档
- **CHANGELOG.md** - 版本更新记录
- **README.md** - 项目概览

### 数据来源
- **东方财富API** - 主要数据源
- **AKShare** - 补充数据源
- **中证指数官网** - 指数基础数据
- **万得数据库** - 专业数据（需付费）

### 学习资源
- [Python 数据分析教程](https://pandas.pydata.org/pandas-docs/stable/getting_started/index.html)
- [TA-Lib 技术指标库](https://ta-lib.org/documentation.html)
- [财务报表分析](https://zhuanlan.zhihu.com/p/34069850)
- [量化投资策略](https://github.com/quantopian/zipline)

## 🔄 更新说明

### v2.1 (2026-02-20) - 新增功能
- ✅ 报告模板引擎
- ✅ 快速报告生成工具
- ✅ 三种报告类型（个股/指数/行业）
- ✅ 命令行参数支持
- ✅ Python API 接口

### v2.0 (2026-02-19) - 修复改进
- ✅ 修复 index_analyzer.py main函数
- ✅ 添加多数据源备用机制
- ✅ 增强错误处理
- ✅ 添加数据缓存机制

### v1.0 (2026-02-18) - 基础功能
- ✅ 个股分析器
- ✅ 指数分析器
- ✅ 财务指标计算
- ✅ 技术指标分析
- ✅ 数据获取功能

---

**最后更新**: 2026年02月20日  
**版本**: v2.1  
**作者**: AI Investment Analyst
